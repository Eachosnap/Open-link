<!DOCTYPE html><html>
<head>
  <title>Firebase Live Video Call</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <style>
    body { font-family: Arial; text-align: center; }
    video { width: 45%; margin: 10px; background: black; }
    input, button { margin: 5px; }
  </style>
</head>
<body>
  <h2>Firebase Live Video Call</h2>
  <input id="roomId" placeholder="Enter Room ID">
  <button onclick="createRoom()">Create Call</button>
  <button onclick="joinRoom()">Join Call</button>
  <br>
  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAJwAOonf9Hb8yCPZyC7TB9mXnyFxVqZRU",
      authDomain: "eachsnap-official.firebaseapp.com",
      databaseURL: "https://eachsnap-official-default-rtdb.firebaseio.com",
      projectId: "eachsnap-official",
      storageBucket: "eachsnap-official.appspot.com",
      messagingSenderId: "783613345614",
      appId: "1:783613345614:web:YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const servers = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
    let pc = new RTCPeerConnection(servers);
    let localStream;

    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');

    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
      localStream = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));
      localVideo.srcObject = stream;
    });

    pc.ontrack = event => {
      remoteVideo.srcObject = event.streams[0];
    };

    async function createRoom() {
      const roomId = document.getElementById('roomId').value;
      const roomRef = db.ref('rooms/' + roomId);

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      roomRef.set({ offer: offer });

      roomRef.on('value', async snapshot => {
        const data = snapshot.val();
        if (data && data.answer && !pc.currentRemoteDescription) {
          await pc.setRemoteDescription(new RTCSessionDescription(data.answer));
        }
      });

      pc.onicecandidate = event => {
        if (event.candidate) {
          roomRef.child('callerCandidates').push(event.candidate.toJSON());
        }
      };

      roomRef.child('calleeCandidates').on('child_added', data => {
        pc.addIceCandidate(new RTCIceCandidate(data.val()));
      });
    }

    async function joinRoom() {
      const roomId = document.getElementById('roomId').value;
      const roomRef = db.ref('rooms/' + roomId);

      const snapshot = await roomRef.once('value');
      const data = snapshot.val();

      if (!data || !data.offer) return alert("Room doesn't exist or no offer found");

      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      roomRef.update({ answer: answer });

      pc.onicecandidate = event => {
        if (event.candidate) {
          roomRef.child('calleeCandidates').push(event.candidate.toJSON());
        }
      };

      roomRef.child('callerCandidates').on('child_added', data => {
        pc.addIceCandidate(new RTCIceCandidate(data.val()));
      });
    }
  </script></body>
</html>
